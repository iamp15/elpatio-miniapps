<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="app-version" content="0.0.0" />
    <title>Retiros - El Patio</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="https://cdn.socket.io/4.7.5/socket.io.min.js"></script>
    <link rel="stylesheet" href="styles.css" />
  </head>
  <body>
    <div id="app">
      <div id="loading" class="screen active">
        <div class="loading-container">
          <div class="loading-spinner"></div>
          <p>Cargando...</p>
        </div>
      </div>

      <div id="main-screen" class="screen">
        <div class="header">
          <h1>ğŸ’¸ Realizar Retiro</h1>
          <p class="subtitle">Retira tu saldo de forma segura</p>
        </div>
        <div class="balance-info">
          <div class="balance-card">
            <span class="balance-label">Saldo disponible:</span>
            <span id="current-balance" class="balance-amount">0 Bs</span>
          </div>
        </div>
        <div class="form-container">
          <form id="retiro-form">
            <div class="form-group">
              <label for="amount">Monto a retirar (Bs)</label>
              <input
                type="number"
                id="amount"
                name="amount"
                placeholder="Ej: 50.00"
                min="1"
                step="0.01"
                required
              />
              <small class="form-help" id="monto-minimo-help">Monto mÃ­nimo: 1 Bs</small>
            </div>
            <button type="submit" class="btn btn-primary" id="request-retiro-btn">
              Continuar
            </button>
          </form>
        </div>
      </div>

      <div id="data-payment-screen" class="screen">
        <div class="header">
          <h1>ğŸ“± Datos para Recibir</h1>
          <p class="subtitle">Indica dÃ³nde deseas recibir el dinero</p>
        </div>
        <div class="form-container">
          <form id="data-payment-form">
            <div class="form-group">
              <label for="data-bank">Banco donde recibirÃ¡s *</label>
              <select id="data-bank" name="data-bank" required>
                <option value="">Selecciona un banco</option>
                <option value="Banesco">Banesco</option>
                <option value="Mercantil">Mercantil</option>
                <option value="Venezuela">Banco de Venezuela</option>
                <option value="BOD">BOD</option>
                <option value="BBVA">BBVA Provincial</option>
                <option value="Bicentenario">Bicentenario</option>
              </select>
            </div>
            <div class="form-group">
              <label for="data-phone">TelÃ©fono (pago mÃ³vil) *</label>
              <input
                type="tel"
                id="data-phone"
                name="data-phone"
                placeholder="04141234567"
                pattern="[0-9]{11}"
                required
              />
            </div>
            <div class="form-group">
              <label for="data-cedula">CÃ©dula (ej: V-12345678) *</label>
              <input
                type="text"
                id="data-cedula"
                name="data-cedula"
                placeholder="V-12345678"
                required
              />
            </div>
            <button type="submit" class="btn btn-primary" id="submit-retiro-btn">
              Solicitar Retiro
            </button>
          </form>
        </div>
      </div>

      <div id="waiting-screen" class="screen">
        <div class="header">
          <h1>â³ Esperando Cajero</h1>
          <p class="subtitle">Tu solicitud estÃ¡ siendo procesada</p>
        </div>
        <div class="transaction-info">
          <div class="info-card">
            <div class="info-row"><span>Monto:</span><span id="waiting-amount">0 Bs</span></div>
            <div class="info-row"><span>Estado:</span><span id="waiting-status" class="status-pending">Pendiente</span></div>
          </div>
        </div>
        <div class="waiting-message">
          <div class="waiting-icon">â°</div>
          <h3>Esperando respuesta del cajero</h3>
          <p>Un cajero puede tardar unos minutos en tomar tu solicitud. Te notificaremos cuando sea aceptada.</p>
        </div>
        <div class="action-buttons">
          <button class="btn btn-cancel" id="cancel-waiting-btn">âŒ Cancelar Solicitud</button>
        </div>
      </div>

      <div id="in-process-screen" class="screen">
        <div class="header">
          <h1>ğŸ”„ Retiro en Proceso</h1>
          <p class="subtitle">El cajero te enviarÃ¡ el dinero</p>
        </div>
        <div class="transaction-info">
          <div class="info-card">
            <div class="info-row"><span>Monto:</span><span id="in-process-amount">0 Bs</span></div>
          </div>
        </div>
        <div class="waiting-message">
          <div class="waiting-icon">ğŸ’¸</div>
          <h3>Procesando tu retiro</h3>
          <p>El cajero estÃ¡ realizando la transferencia. RecibirÃ¡s una notificaciÃ³n cuando se complete.</p>
        </div>
      </div>

      <div id="completed-screen" class="screen">
        <div class="header">
          <h1>ğŸ‰ Retiro Completado</h1>
          <p class="subtitle">Tu retiro ha sido procesado exitosamente</p>
        </div>
        <div class="confirmation-info">
          <div class="info-card">
            <div class="info-row"><span>Monto retirado:</span><span id="completed-amount">0 Bs</span></div>
            <div class="info-row"><span>Nuevo saldo:</span><span id="completed-balance">0 Bs</span></div>
          </div>
          <div id="comprobante-link-container" style="display: none; margin-top: 16px;">
            <a id="comprobante-link" href="#" target="_blank" class="btn btn-secondary">ğŸ“· Ver Comprobante</a>
          </div>
          <button class="btn btn-primary" id="close-app-btn" style="margin-top: 20px;">Cerrar</button>
        </div>
      </div>

      <div id="error-screen" class="screen">
        <div class="error-info">
          <div class="error-icon">âŒ</div>
          <h3 id="error-title">Error</h3>
          <p id="error-message">Ha ocurrido un error.</p>
          <div class="error-actions">
            <button class="btn btn-primary" id="retry-btn">Reintentar</button>
            <button class="btn btn-secondary" id="close-error-btn">Cerrar</button>
          </div>
        </div>
      </div>
    </div>

    <div id="debug-panel" class="debug-panel">
      <div class="debug-header">
        <h4>ğŸ” Logs del Sistema</h4>
        <button id="toggle-logs-btn" class="toggle-logs-btn">ğŸ“‹</button>
        <button id="clear-logs-btn" class="clear-logs-btn">ğŸ—‘ï¸</button>
      </div>
      <div id="logs-container" class="logs-container"></div>
    </div>

    <div id="confirm-modal" class="modal-overlay" style="display: none">
      <div class="modal-container">
        <div class="modal-header"><h3 id="modal-title">ConfirmaciÃ³n</h3></div>
        <div class="modal-body"><p id="modal-message">Â¿EstÃ¡s seguro?</p></div>
        <div class="modal-actions">
          <button class="btn btn-secondary" id="modal-cancel-btn">No, volver</button>
          <button class="btn btn-cancel" id="modal-confirm-btn">SÃ­, cancelar</button>
        </div>
      </div>
    </div>

    <script src="js/logger.js"></script>
    <script src="js/websocket.js"></script>
    <script type="module" src="app.js"></script>
  </body>
</html>
