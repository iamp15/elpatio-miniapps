<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Dep√≥sitos - El Patio</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="https://cdn.socket.io/4.7.5/socket.io.min.js"></script>
    <link rel="stylesheet" href="styles.css" />
  </head>
  <body>
    <div id="app">
      <!-- Pantalla de carga -->
      <div id="loading" class="screen active">
        <div class="loading-container">
          <div class="loading-spinner"></div>
          <p>Cargando...</p>
        </div>
      </div>

      <!-- Pantalla principal de dep√≥sitos -->
      <div id="main-screen" class="screen">
        <div class="header">
          <h1>üí≥ Realizar Dep√≥sito</h1>
          <p class="subtitle">A√±ade saldo a tu cuenta de forma segura</p>
        </div>

        <div class="balance-info">
          <div class="balance-card">
            <span class="balance-label">Saldo actual:</span>
            <span id="current-balance" class="balance-amount">0 Bs</span>
          </div>
        </div>

        <div class="form-container">
          <form id="deposit-form">
            <div class="form-group">
              <label for="amount">Monto a depositar (Bs)</label>
              <input
                type="number"
                id="amount"
                name="amount"
                placeholder="Ej: 50.00"
                min="1"
                step="0.01"
                required
              />
              <small class="form-help" id="monto-minimo-help">Monto m√≠nimo: 1 Bs</small>
            </div>

            <div class="form-group" style="display: none">
              <label for="amount-cents">Monto en centavos</label>
              <input
                type="number"
                id="amount-cents"
                name="amount-cents"
                readonly
                class="readonly"
              />
              <small class="form-help">Se calcula autom√°ticamente</small>
            </div>

            <button
              type="submit"
              class="btn btn-primary"
              id="request-deposit-btn"
            >
              Solicitar Dep√≥sito
            </button>
          </form>
        </div>
      </div>

      <!-- Pantalla de espera (cajero asignado) -->
      <div id="waiting-screen" class="screen">
        <div class="header">
          <h1>‚è≥ Esperando Cajero</h1>
          <p class="subtitle">Tu solicitud est√° siendo procesada</p>
        </div>

        <div class="transaction-info">
          <div class="info-card">
            <h3>Detalles de la solicitud</h3>
            <div class="info-row">
              <span>Monto:</span>
              <span id="waiting-amount">0 Bs</span>
            </div>
            <div class="info-row">
              <span>Estado:</span>
              <span id="waiting-status" class="status-pending">Pendiente</span>
            </div>
          </div>
        </div>

        <div class="waiting-message">
          <div class="waiting-icon">‚è∞</div>
          <h3>Esperando respuesta del cajero</h3>
          <p>
            Un cajero puede tardar unos minutos en tomar tu solicitud. Te
            notificaremos tan pronto como sea aceptada.
          </p>
        </div>

        <!-- Bot√≥n para cancelar la solicitud -->
        <div class="action-buttons">
          <button class="btn btn-cancel" id="cancel-waiting-btn">
            ‚ùå Cancelar Solicitud
          </button>
        </div>
      </div>

      <!-- Pantalla de datos bancarios -->
      <div id="bank-info-screen" class="screen">
        <div class="header">
          <h1>üè¶ Datos para Pago</h1>
          <p class="subtitle">Realiza el pago m√≥vil con estos datos</p>
        </div>

        <div class="bank-info">
          <div class="bank-card">
            <h3>Datos del Cajero</h3>
            <div class="bank-details">
              <div class="detail-row">
                <span class="label">Banco:</span>
                <span id="bank-name" class="value">-</span>
                <button
                  class="copy-btn"
                  onclick="copyToClipboard('bank-name')"
                  title="Copiar banco"
                >
                  üìã
                </button>
              </div>
              <div class="detail-row">
                <span class="label">Tel√©fono:</span>
                <span id="bank-phone" class="value">-</span>
                <button
                  class="copy-btn"
                  onclick="copyToClipboard('bank-phone')"
                  title="Copiar tel√©fono"
                >
                  üìã
                </button>
              </div>
              <div class="detail-row">
                <span class="label">C√©dula:</span>
                <span id="bank-id" class="value">-</span>
                <button
                  class="copy-btn"
                  onclick="copyToClipboard('bank-id')"
                  title="Copiar c√©dula"
                >
                  üìã
                </button>
              </div>
              <div class="detail-row">
                <span class="label">Monto:</span>
                <span id="bank-amount" class="value amount">-</span>
                <button
                  class="copy-btn"
                  onclick="copyToClipboard('bank-amount')"
                  title="Copiar monto"
                >
                  üìã
                </button>
              </div>
            </div>

            <!-- Bot√≥n para copiar todos los datos -->
            <div class="copy-all-section">
              <button
                class="btn btn-copy-all"
                id="copy-all-btn"
                onclick="copyAllBankData()"
              >
                üìã Copiar Todos los Datos
              </button>
            </div>
          </div>

          <div class="instructions">
            <h4>Instrucciones:</h4>
            <ol>
              <li>Realiza un pago m√≥vil con los datos mostrados</li>
              <li>Guarda el n√∫mero de referencia del pago</li>
              <li>Haz clic en "Ya realic√© el pago" cuando termines</li>
            </ol>
          </div>

          <div class="action-buttons">
            <button class="btn btn-success" id="payment-done-btn">
              ‚úÖ Ya realic√© el pago
            </button>
            <button class="btn btn-cancel" id="cancel-bank-info-btn">
              ‚ùå Cancelar Dep√≥sito
            </button>
          </div>
        </div>
      </div>

      <!-- Pantalla de confirmaci√≥n de pago -->
      <div id="payment-confirmation-screen" class="screen">
        <div class="header">
          <h1>üìù Confirmar Pago</h1>
          <p class="subtitle">Ingresa los datos de tu pago m√≥vil</p>
        </div>

        <div class="form-container">
          <form id="payment-confirmation-form">
            <div class="form-group">
              <label for="payment-bank">Banco desde donde pagaste</label>
              <select id="payment-bank" name="payment-bank" required>
                <option value="">Selecciona un banco</option>
                <option value="Banesco">Banesco</option>
                <option value="Mercantil">Mercantil</option>
                <option value="Venezuela">Banco de Venezuela</option>
                <option value="BOD">BOD</option>
                <option value="BBVA">BBVA Provincial</option>
                <option value="Bicentenario">Bicentenario</option>
              </select>
            </div>

            <div class="form-group">
              <label for="payment-phone">Tel√©fono desde donde pagaste</label>
              <input
                type="tel"
                id="payment-phone"
                name="payment-phone"
                placeholder="04141234567"
                pattern="[0-9]{11}"
                required
              />
            </div>

            <div class="form-group">
              <label for="payment-reference"
                >N√∫mero de referencia del pago</label
              >
              <input
                type="text"
                id="payment-reference"
                name="payment-reference"
                placeholder="Ej: PAGO123456"
                required
              />
            </div>

            <div class="form-group">
              <label for="payment-date">Fecha del pago</label>
              <input
                type="date"
                id="payment-date"
                name="payment-date"
                required
              />
            </div>

            <div class="form-actions">
              <button
                type="button"
                class="btn btn-secondary"
                id="back-to-bank-btn"
              >
                ‚Üê Volver
              </button>
              <button
                type="submit"
                class="btn btn-primary"
                id="confirm-payment-btn"
              >
                Confirmar Pago
              </button>
            </div>
          </form>
        </div>
      </div>

      <!-- Pantalla de pago confirmado por usuario (esperando verificaci√≥n del cajero) -->
      <div id="user-payment-confirmed-screen" class="screen">
        <div class="header">
          <h1>‚úÖ Pago Confirmado por Ti</h1>
          <p class="subtitle">Esperando verificaci√≥n del cajero</p>
        </div>

        <div class="confirmation-info">
          <div class="info-card">
            <div class="info-row">
              <span>Monto:</span>
              <span id="registered-amount">0 Bs</span>
            </div>
            <div class="info-row">
              <span>Fecha:</span>
              <span id="registered-date">-</span>
            </div>
            <div class="info-row">
              <span>Referencia:</span>
              <span id="registered-reference">-</span>
            </div>
            <div class="info-row">
              <span>Estado:</span>
              <span id="registered-status" class="status-processing"
                >En verificaci√≥n</span
              >
            </div>
          </div>

          <div class="waiting-message">
            <div class="waiting-icon">‚è≥</div>
            <h3>Verificando pago</h3>
            <p>
              El cajero est√° verificando tu pago. En los pr√≥ximos minutos se
              acreditar√° el dep√≥sito a tu saldo.
            </p>
          </div>
        </div>
      </div>

      <!-- Pantalla de dep√≥sito verificado por cajero (confirmaci√≥n final) -->
      <div id="cashier-verified-screen" class="screen">
        <div class="header">
          <h1>üéâ Dep√≥sito Verificado por Cajero</h1>
          <p class="subtitle">Tu dep√≥sito ha sido acreditado exitosamente</p>
        </div>

        <div class="confirmation-info">
          <h3>¬°Gracias por tu dep√≥sito!</h3>

          <div class="info-card">
            <div class="info-row">
              <span>Monto:</span>
              <span id="final-amount">0 Bs</span>
            </div>
            <div class="info-row">
              <span>Fecha:</span>
              <span id="final-date">-</span>
            </div>
            <div class="info-row">
              <span>Referencia:</span>
              <span id="final-reference">-</span>
            </div>
            <div class="info-row">
              <span>Nuevo saldo:</span>
              <span id="final-balance">0 Bs</span>
            </div>
          </div>

          <div class="completion-message">
            <p>
              üéâ ¬°Perfecto! Ya puedes cerrar esta ventana y disfrutar de tus
              partidas en El Patio. üéÆ‚ú®
            </p>
          </div>

          <button class="btn btn-primary" id="close-app-btn">Cerrar</button>
        </div>
      </div>

      <!-- Pantalla de dep√≥sito verificado con ajuste de monto -->
      <div id="adjusted-approved-screen" class="screen">
        <div class="header">
          <h1>üéØ Dep√≥sito Acreditado con Ajuste</h1>
          <p class="subtitle">Tu dep√≥sito fue verificado por el cajero con un ajuste en el monto</p>
        </div>

        <div class="confirmation-info">
          <h3>Detalles de acreditaci√≥n</h3>

          <div class="info-card">
            <div class="info-row">
              <span>Monto acreditado:</span>
              <span id="adjusted-amount">0 Bs</span>
            </div>
            <div class="info-row">
              <span>Fecha:</span>
              <span id="adjusted-date">-</span>
            </div>
            <div class="info-row">
              <span>Referencia:</span>
              <span id="adjusted-reference">-</span>
            </div>
          </div>

          <div class="completion-message">
            <p id="adjusted-note">
              Se acredit√≥ tu dep√≥sito con un ajuste de monto. Si consideras que hubo un error, por favor contacta a un administrador.
            </p>
          </div>

          <button class="btn btn-primary" id="close-app-btn">Cerrar</button>
        </div>
      </div>

      <!-- Pantalla de error -->
      <div id="error-screen" class="screen">
        <div class="header">
          <h1>‚ùå Error</h1>
          <p class="subtitle">Algo sali√≥ mal</p>
        </div>

        <div class="error-info">
          <div class="error-icon">‚ùå</div>
          <h3 id="error-title">Error en el proceso</h3>
          <p id="error-message">Ha ocurrido un error inesperado.</p>

          <button class="btn btn-primary" id="retry-btn">Reintentar</button>
          <button class="btn btn-secondary" id="close-error-btn">Cerrar</button>
        </div>
      </div>
    </div>

    <!-- Panel de logs para debugging -->
    <div id="debug-panel" class="debug-panel">
      <div class="debug-header">
        <h4>üîç Logs del Sistema</h4>
        <button id="toggle-logs-btn" class="toggle-logs-btn">üìã</button>
        <button id="clear-logs-btn" class="clear-logs-btn">üóëÔ∏è</button>
      </div>
      <div id="logs-container" class="logs-container">
        <div class="log-entry info">[Sistema] Aplicaci√≥n iniciada</div>
      </div>
    </div>

    <!-- Modal de confirmaci√≥n -->
    <div id="confirm-modal" class="modal-overlay" style="display: none">
      <div class="modal-container">
        <div class="modal-header">
          <h3 id="modal-title">Confirmaci√≥n</h3>
        </div>
        <div class="modal-body">
          <p id="modal-message">¬øEst√°s seguro?</p>
        </div>
        <div class="modal-actions">
          <button class="btn btn-secondary" id="modal-cancel-btn">
            No, volver
          </button>
          <button class="btn btn-cancel" id="modal-confirm-btn">
            S√≠, cancelar
          </button>
        </div>
      </div>
    </div>

    <script src="js/logger.js"></script>
    <script src="js/websocket.js"></script>
    <script type="module" src="app.js"></script>
  </body>
</html>
