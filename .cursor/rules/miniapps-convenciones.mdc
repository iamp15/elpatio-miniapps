---
description: Convenciones y est√°ndares espec√≠ficos para las Mini Apps de El Patio
globs: ["elpatio-miniapps/**/*.js", "elpatio-miniapps/**/*.html"]
alwaysApply: false
---

# Mini Apps - El Patio - Convenciones y Est√°ndares

## Estado del proyecto

- Las miniapps est√°n desplegadas en **Vercel** (producci√≥n)
- El backend se encuentra corriendo en una VM de **fly.io**
- Todas las pruebas se hacen con el servidor live, no se hacen en local
- Las miniapps funcionan dentro del navegador de Telegram, que no puede comunicarse con servidores locales

## üìã Estructura del M√≥dulo

Las miniapps siguen una arquitectura modular con ES6 modules:

```
elpatio-miniapps/
‚îú‚îÄ‚îÄ server.js              # Servidor Express para desarrollo local
‚îú‚îÄ‚îÄ config.js              # Configuraci√≥n compartida
‚îú‚îÄ‚îÄ vercel.json            # Configuraci√≥n de Vercel
‚îú‚îÄ‚îÄ package.json           # Dependencias y scripts
‚îú‚îÄ‚îÄ depositos/             # Mini app de dep√≥sitos
‚îÇ       ‚îú‚îÄ‚îÄ ui.js          # Gesti√≥n de interfaz de usuario
‚îÇ       ‚îú‚îÄ‚îÄ websocket.js   # Cliente WebSocket
‚îÇ       ‚îú‚îÄ‚îÄ transactions.js # Gesti√≥n de transacciones
‚îÇ       ‚îú‚îÄ‚îÄ notifications.js # Sistema de notificaciones toast
‚îÇ       ‚îú‚îÄ‚îÄ notification-manager.js # Gestor de notificaciones persistentes
‚îÇ       ‚îî‚îÄ‚îÄ push-notifications.js # Notificaciones del navegador
‚îú‚îÄ‚îÄ depositos/             # Mini app de dep√≥sitos
‚îÇ   ‚îú‚îÄ‚îÄ app.js             # Aplicaci√≥n principal
‚îÇ   ‚îú‚îÄ‚îÄ index.html         # HTML principal
‚îÇ   ‚îú‚îÄ‚îÄ styles.css         # Estilos CSS
‚îÇ   ‚îî‚îÄ‚îÄ js/                # M√≥dulos JavaScript
‚îÇ       ‚îú‚îÄ‚îÄ api.js         # Comunicaci√≥n con backend
‚îÇ       ‚îú‚îÄ‚îÄ auth.js        # Autenticaci√≥n Telegram Web App
‚îÇ       ‚îú‚îÄ‚îÄ config.js      # Configuraci√≥n espec√≠fica
‚îÇ       ‚îú‚îÄ‚îÄ ui.js          # Gesti√≥n de interfaz
‚îÇ       ‚îú‚îÄ‚îÄ websocket.js   # Cliente WebSocket
‚îÇ       ‚îú‚îÄ‚îÄ transactions.js # Gesti√≥n de transacciones
‚îÇ       ‚îî‚îÄ‚îÄ logger.js      # Sistema de logging visual
‚îî‚îÄ‚îÄ env.example            # Ejemplo de variables de entorno
```

## üîß Convenciones de C√≥digo

### M√≥dulos ES6

- **Usar ES6 modules** (import/export) en lugar de CommonJS
- Un archivo por m√≥dulo/clase
- Exportar clases o instancias √∫nicas (singleton pattern)
- Importar solo lo necesario (no usar `import *`)

### Patr√≥n de Clases

```javascript
/**
 * Descripci√≥n del m√≥dulo
 * @version X.X.X
 */

class ModuleManager {
  constructor() {
    this.property = null;
    this.callbacks = {};
  }

  /**
   * Descripci√≥n del m√©todo
   * @param {Type} param - Descripci√≥n del par√°metro
   * @returns {Type} Descripci√≥n del retorno
   */
  async methodName(param) {
    try {
      // L√≥gica del m√©todo
    } catch (error) {
      console.error("Error en methodName:", error);
      throw error;
    }
  }
}

// Crear instancia √∫nica (singleton)
export const ModuleInstance = new ModuleManager();
```

### Estructura de la Aplicaci√≥n Principal

```javascript
/**
 * Aplicaci√≥n principal - Versi√≥n modular
 * @version X.X.X
 */

import { Auth } from "./js/auth.js";
import { UI } from "./js/ui.js";
import { TransactionManager } from "./js/transactions.js";
import { MESSAGES, API_CONFIG } from "./js/config.js";

class App {
  constructor() {
    this.isInitialized = false;
    this.version = "X.X.X";
  }

  /**
   * Inicializar la aplicaci√≥n
   */
  async init() {
    if (this.isInitialized) return;

    try {
      // Configurar WebSocket
      this.setupWebSocket();

      // Configurar callbacks
      Auth.setCallbacks({
        onLoginSuccess: this.handleLoginSuccess.bind(this),
        onError: this.handleError.bind(this),
      });

      // Configurar event listeners de la UI
      UI.setupEventListeners({
        onAction: this.handleAction.bind(this),
      });

      // Inicializar autenticaci√≥n
      await Auth.init();

      // Hacer disponibles instancias globalmente
      window.app = this;
      window.transactionManager = TransactionManager;

      this.isInitialized = true;
    } catch (error) {
      console.error("Error inicializando la aplicaci√≥n:", error);
      UI.showError("Error al inicializar la aplicaci√≥n");
    }
  }
}

// Crear instancia √∫nica
const app = new App();

// Inicializar cuando se carga el DOM
document.addEventListener("DOMContentLoaded", () => {
  app.init();
});

// Exportar para uso en otros m√≥dulos
export default app;
```

## üåê API y Comunicaci√≥n

### M√≥dulo API (api.js)

- Clase `APIManager` para gestionar todas las peticiones HTTP
- Usar `fetch` API nativo (no axios u otras librer√≠as)
- M√©todos async/await (nunca Promises.then())
- Try-catch en todos los m√©todos async
- Centralizar configuraci√≥n de URLs en `API_CONFIG`

### Patr√≥n de API

```javascript
class APIManager {
  constructor() {
    this.baseURL = API_CONFIG.BASE_URL;
    this.endpoints = API_CONFIG.ENDPOINTS;
  }

  /**
   * Realizar request HTTP gen√©rico
   */
  async request(url, options = {}) {
    const defaultOptions = {
      headers: {
        "Content-Type": "application/json",
        ...options.headers,
      },
      ...options,
    };

    try {
      const response = await fetch(url, defaultOptions);
      return response;
    } catch (error) {
      console.error("Error en request:", error);
      throw new Error(MESSAGES.ERROR.CONNECTION);
    }
  }

  /**
   * Realizar request autenticado
   */
  async authenticatedRequest(url, token, options = {}) {
    if (!token) {
      throw new Error(MESSAGES.ERROR.NO_TOKEN);
    }

    const authOptions = {
      ...options,
      headers: {
        Authorization: `Bearer ${token}`,
        "Content-Type": "application/json",
        ...options.headers,
      },
    };

    return this.request(url, authOptions);
  }

  /**
   * Realizar request con datos de Telegram
   */
  async telegramRequest(url, options = {}) {
    const telegramId =
      options.telegramId || window.Telegram?.WebApp?.initDataUnsafe?.user?.id;

    const { telegramId: _, ...restOptions } = options;

    const telegramOptions = {
      ...restOptions,
      headers: {
        "Content-Type": "application/json",
        "X-Telegram-Id": telegramId ? telegramId.toString() : "",
        ...restOptions.headers,
      },
    };

    return this.request(url, telegramOptions);
  }
}

// Crear instancia √∫nica
export const API = new APIManager();
```

### Convenciones de Endpoints

- URLs base en `API_CONFIG.BASE_URL`
- Endpoints espec√≠ficos en `API_CONFIG.ENDPOINTS`
- Usar nombres descriptivos en espa√±ol o ingl√©s seg√∫n contexto
- Agrupar endpoints relacionados (ej: todos los de transacciones juntos)

## üîå WebSocket

### Cliente WebSocket (websocket.js)

- Clase para gestionar conexi√≥n WebSocket con Socket.IO
- Sistema de callbacks para eventos
- Manejo de reconexi√≥n autom√°tica
- Autenticaci√≥n autom√°tica despu√©s de reconexi√≥n
- Tracking de transacciones activas para recuperaci√≥n

### Patr√≥n de WebSocket

```javascript
class AppWebSocket {
  constructor() {
    this.socket = null;
    this.isConnected = false;
    this.isAuthenticated = false;
    this.reconnectAttempts = 0;
    this.maxReconnectAttempts = 10;
    this.activeTransactionId = null;
    this.callbacks = {};
  }

  /**
   * Conectar al servidor WebSocket
   */
  connect() {
    if (this.socket && this.isConnected) return;

    const socketUrl = this.getSocketUrl();
    
    this.socket = io(socketUrl, {
      transports: ["websocket", "polling"],
      reconnection: true,
      reconnectionAttempts: 10,
      reconnectionDelay: 1000,
    });

    this.setupEventHandlers();
  }

  /**
   * Configurar manejadores de eventos
   */
  setupEventHandlers() {
    this.socket.on("connect", () => {
      this.isConnected = true;
      this.reconnectAttempts = 0;
      
      // Re-autenticar autom√°ticamente si hay token
      if (this.lastAuthToken) {
        this.reauthenticate();
      }

      if (this.callbacks.onConnect) {
        this.callbacks.onConnect();
      }
    });

    this.socket.on("disconnect", (reason) => {
      this.isConnected = false;
      this.isAuthenticated = false;
      
      if (this.callbacks.onDisconnect) {
        this.callbacks.onDisconnect(reason);
      }
    });

    // Eventos espec√≠ficos de la aplicaci√≥n
    this.socket.on("evento-especifico", (data) => {
      if (this.callbacks.onEventoEspecifico) {
        this.callbacks.onEventoEspecifico(data);
      }
    });
  }

  /**
   * Configurar callbacks
   */
  setCallbacks(callbacks) {
    this.callbacks = { ...this.callbacks, ...callbacks };
  }

  /**
   * M√©todo para usar callbacks (compatibilidad)
   */
  on(event, callback) {
    if (this.callbacks.hasOwnProperty(event)) {
      this.callbacks[event] = callback;
    }
  }
}

// Crear instancia global
window.appWebSocket = new AppWebSocket();
```

### Convenciones WebSocket

- Nombres de eventos en kebab-case y espa√±ol
- Callbacks con nombres descriptivos: `onEventoRecibido`
- Manejar desconexiones gracefully con reconexi√≥n autom√°tica
- Re-autenticar autom√°ticamente despu√©s de reconexi√≥n
- Trackear transacciones activas para sistema de recuperaci√≥n

## üîê Autenticaci√≥n

### Autenticaci√≥n de Telegram (depositos/js/auth.js)

- Usar Telegram Web App API (`window.Telegram.WebApp`)
- Validar datos de inicializaci√≥n con backend
- Obtener datos del usuario desde Telegram
- Manejar timeout si Telegram no est√° disponible

### Patr√≥n de Autenticaci√≥n

```javascript
class AuthManager {
  constructor() {
    this.currentToken = null;
    this.userData = null;
    this.callbacks = {
      onLoginSuccess: null,
      onError: null,
      onTokenExpired: null,
    };
  }

  /**
   * Inicializar autenticaci√≥n
   */
  async init() {
    const savedToken = localStorage.getItem(STORAGE_KEYS.TOKEN);
    if (savedToken) {
      await this.verifyToken(savedToken);
    }
  }

  /**
   * Configurar callbacks
   */
  setCallbacks(callbacks) {
    this.callbacks = { ...this.callbacks, ...callbacks };
  }

  /**
   * Realizar login
   */
  async login(email, password) {
    try {
      const response = await API.login(email, password);
      
      if (response.ok) {
        const data = await response.json();
        this.currentToken = data.token;
        localStorage.setItem(STORAGE_KEYS.TOKEN, this.currentToken);
        
        await this.loadUserInfo();
        
        if (this.callbacks.onLoginSuccess) {
          this.callbacks.onLoginSuccess(this.userData);
        }
        
        return { success: true, userData: this.userData };
      } else {
        const errorData = await response.json();
        throw new Error(errorData.mensaje || MESSAGES.ERROR.INVALID_CREDENTIALS);
      }
    } catch (error) {
      if (this.callbacks.onError) {
        this.callbacks.onError(error);
      }
      throw error;
    }
  }

  /**
   * Logout
   */
  logout() {
    this.clearSession();
  }

  /**
   * Limpiar sesi√≥n
   */
  clearSession() {
    this.currentToken = null;
    this.userData = null;
    localStorage.removeItem(STORAGE_KEYS.TOKEN);
  }
}

export const Auth = new AuthManager();
```

## üé® Interfaz de Usuario (UI)

### M√≥dulo UI (ui.js)

- Clase `UIManager` para gestionar toda la interfaz
- Separar l√≥gica de presentaci√≥n de l√≥gica de negocio
- M√©todos para mostrar/ocultar pantallas
- Validaci√≥n de formularios
- Actualizaci√≥n de elementos del DOM

### Patr√≥n de UI

```javascript
class UIManager {
  constructor() {
    this.elements = {};
    this.currentState = null;
    this.initElements();
  }

  /**
   * Inicializar referencias a elementos del DOM
   */
  initElements() {
    this.elements.screen1 = document.querySelector("#screen-1");
    this.elements.screen2 = document.querySelector("#screen-2");
    this.elements.form = document.querySelector("#form");
    // ... m√°s elementos
  }

  /**
   * Configurar event listeners
   */
  setupEventListeners(eventHandlers) {
    if (this.elements.form && eventHandlers.onSubmit) {
      this.elements.form.addEventListener("submit", eventHandlers.onSubmit);
    }
    // ... m√°s listeners
  }

  /**
   * Mostrar pantalla
   */
  showScreen(screenId) {
    // Ocultar todas las pantallas
    document.querySelectorAll(".screen").forEach((screen) => {
      screen.classList.remove("active");
    });

    // Mostrar pantalla espec√≠fica
    const screen = document.querySelector(screenId);
    if (screen) {
      screen.classList.add("active");
      this.currentState = screenId;
    }
  }

  /**
   * Obtener datos del formulario
   */
  getFormData() {
    const form = this.elements.form;
    if (!form) return null;

    const formData = new FormData(form);
    return {
      field1: formData.get("field1"),
      field2: formData.get("field2"),
    };
  }

  /**
   * Validar formulario
   */
  validateForm(formData) {
    if (!formData.field1) {
      return {
        valid: false,
        message: "Campo requerido",
      };
    }
    return { valid: true };
  }

  /**
   * Mostrar error
   */
  showError(message) {
    const errorElement = this.elements.errorMessage;
    if (errorElement) {
      errorElement.textContent = message;
      errorElement.style.display = "block";
    }
  }

  /**
   * Ocultar error
   */
  hideError() {
    const errorElement = this.elements.errorMessage;
    if (errorElement) {
      errorElement.style.display = "none";
    }
  }
}

export const UI = new UIManager();
```

### Convenciones de UI

- Usar selectores CSS en `DOM_SELECTORS` (config.js)
- Pantallas con clase `.screen` y estado `.active`
- Formularios con validaci√≥n antes de enviar
- Mensajes de error descriptivos en espa√±ol
- Estados de carga con spinners o indicadores visuales

## üìù Configuraci√≥n

### Archivo config.js

- Centralizar toda la configuraci√≥n en un archivo
- Exportar objetos constantes con configuraci√≥n
- Separar por categor√≠as: API, UI, Mensajes, Estados, etc.

### Patr√≥n de Configuraci√≥n

```javascript
/**
 * Configuraci√≥n de la aplicaci√≥n
 */

// Configuraci√≥n de la API
export const API_CONFIG = {
  BASE_URL: "https://elpatio-backend.fly.dev/api",
  ENDPOINTS: {
    LOGIN: "/cajeros/login",
    PERFIL: "/cajeros/mi-perfil",
    TRANSACCIONES: "/transacciones",
  },
};

// Configuraci√≥n de localStorage
export const STORAGE_KEYS = {
  TOKEN: "app_token",
  USER_DATA: "user_data",
};

// Configuraci√≥n de la UI
export const UI_CONFIG = {
  LOADING_DELAY: 300,
  ANIMATION_DURATION: 300,
};

// Mensajes de la aplicaci√≥n
export const MESSAGES = {
  ERROR: {
    CONNECTION: "Error de conexi√≥n. Verifica tu conexi√≥n a internet.",
    INVALID_CREDENTIALS: "Error al iniciar sesi√≥n",
    INCOMPLETE_FIELDS: "Por favor, completa todos los campos",
  },
  SUCCESS: {
    LOGIN: "Sesi√≥n iniciada exitosamente",
  },
};

// Estados de la aplicaci√≥n
export const APP_STATES = {
  LOGIN: "login",
  DASHBOARD: "dashboard",
  LOADING: "loading",
  ERROR: "error",
};

// Selectores DOM
export const DOM_SELECTORS = {
  LOGIN_SCREEN: "#login-screen",
  DASHBOARD_SCREEN: "#dashboard-screen",
  LOGIN_FORM: "#login-form",
  ERROR_MESSAGE: "#error-message",
};
```

## üìä Logging y Debugging

### Sistema de Logging Visual

- Usar `window.visualLogger` para logs visuales (si est√° disponible)
- Diferentes niveles: `info`, `success`, `error`, `warning`, `debug`
- Logs con emojis para mejor identificaci√≥n visual
- Console.log para debugging en desarrollo

### Patr√≥n de Logging

```javascript
// Si existe visualLogger, usarlo
if (window.visualLogger) {
  window.visualLogger.info("Mensaje informativo");
  window.visualLogger.success("Operaci√≥n exitosa");
  window.visualLogger.error("Error ocurrido");
  window.visualLogger.warning("Advertencia");
  window.visualLogger.debug("Informaci√≥n de debug");
} else {
  // Fallback a console
  console.log("‚ÑπÔ∏è Mensaje informativo");
  console.log("‚úÖ Operaci√≥n exitosa");
  console.error("‚ùå Error ocurrido");
  console.warn("‚ö†Ô∏è Advertencia");
  console.debug("üîç Informaci√≥n de debug");
}
```

### Emojis para Logs

- ‚úÖ √âxito
- ‚ùå Error
- ‚ö†Ô∏è Advertencia
- üîÑ Proceso/Recarga
- üîó Conexi√≥n
- üîå Desconexi√≥n
- üîê Autenticaci√≥n
- üí∞ Transacciones/Dinero
- üìã Informaci√≥n/Listas
- üõë Detenci√≥n
- üîç B√∫squeda/Verificaci√≥n
- ‚è±Ô∏è Tiempo/Timeout
- üéâ Celebraci√≥n/Completado

## üéØ Gesti√≥n de Transacciones

### M√≥dulo Transactions (transactions.js)

- Clase `TransactionManager` para gestionar transacciones
- M√©todos para crear, actualizar, cancelar transacciones
- Callbacks para eventos de transacciones
- Conversi√≥n de montos (centavos ‚Üî bol√≠vares)

### Patr√≥n de Transactions

```javascript
class TransactionManager {
  constructor() {
    this.currentTransaction = null;
    this.transactions = [];
    this.callbacks = {
      onTransactionCreated: null,
      onTransactionUpdated: null,
      onTransactionCompleted: null,
      onTransactionError: null,
    };
  }

  /**
   * Configurar callbacks
   */
  setCallbacks(callbacks) {
    this.callbacks = { ...this.callbacks, ...callbacks };
  }

  /**
   * Convertir bol√≠vares a centavos
   */
  convertToCents(amount) {
    return Math.round(amount * 100);
  }

  /**
   * Convertir centavos a bol√≠vares
   */
  convertToBolivares(cents) {
    return (cents / 100).toFixed(2);
  }

  /**
   * Cargar transacciones
   */
  async loadTransactions(token) {
    try {
      const response = await API.getTransacciones(token);
      if (response.ok) {
        const data = await response.json();
        this.transactions = data.transacciones;
        this.updateUI();
      }
    } catch (error) {
      console.error("Error cargando transacciones:", error);
      if (this.callbacks.onTransactionError) {
        this.callbacks.onTransactionError(error);
      }
    }
  }
}

export const TransactionManager = new TransactionManager();
```

## üåê HTML y Estructura

### Estructura HTML

- HTML sem√°ntico con secciones claras
- Pantallas separadas con clase `.screen`
- Una pantalla activa a la vez (clase `.active`)
- IDs descriptivos para elementos importantes
- Formularios con validaci√≥n HTML5

### Patr√≥n HTML

```html
<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>El Patio - Nombre de la App</title>
    <script src="https://cdn.socket.io/4.7.5/socket.io.min.js"></script>
    <link rel="stylesheet" href="styles.css" />
  </head>
  <body>
    <div id="app">
      <!-- Pantalla 1 -->
      <div id="screen-1" class="screen active">
        <!-- Contenido -->
      </div>

      <!-- Pantalla 2 -->
      <div id="screen-2" class="screen">
        <!-- Contenido -->
      </div>
    </div>

    <script src="js/websocket.js"></script>
    <script type="module" src="app.js"></script>
  </body>
</html>
```

### Convenciones HTML

- Usar `lang="es"` en el tag `<html>`
- Meta viewport para responsive design
- Cargar Socket.IO desde CDN antes de los scripts propios
- Scripts con `type="module"` para ES6 modules
- IDs en kebab-case (ej: `#login-screen`)

## üé® CSS y Estilos

### Estilos CSS

- Un archivo `styles.css` por miniapp
- Clases sem√°nticas y descriptivas
- Usar variables CSS para colores y valores comunes
- Dise√±o responsive (mobile-first)
- Animaciones suaves para transiciones
- Usar paleta de colores pre-establecida en referencia a un patio de juegos

### Convenciones CSS

- Clases en kebab-case (ej: `.login-screen`)
- IDs solo para elementos √∫nicos importantes
- Variables CSS para valores reutilizables
- Media queries para responsive design
- Animaciones con `transition` o `@keyframes`

## üîÑ Manejo de Estados

### Estados de Transacciones

- Estados definidos en `TRANSACTION_STATES` (config.js)
- Transiciones de estado claras y documentadas
- Callbacks para cambios de estado
- UI actualizada seg√∫n estado actual

### Estados Comunes

```javascript
export const TRANSACTION_STATES = {
  PENDIENTE: "pendiente",
  EN_PROCESO: "en_proceso",
  REALIZADA: "realizada",
  CONFIRMADA: "confirmada",
  COMPLETADA: "completada",
  CANCELADA: "cancelada",
  EXPIRADA: "expirada",
  RECHAZADA: "rechazada",
};
```

## üöÄ Despliegue y Configuraci√≥n

### Vercel

- Configuraci√≥n en `vercel.json`
- Variables de entorno en dashboard de Vercel
- Headers para permitir iframe de Telegram
- Rewrites para rutas de miniapps

### Variables de Entorno

- `API_BASE_URL`: URL del backend
- `NODE_ENV`: Entorno (production/development)
- `TELEGRAM_BOT_TOKEN`: Token del bot (si se usa)
- Documentar en `env.example`

### Servidor Local (server.js)

- Express para servir archivos est√°ticos
- Headers para Telegram Web Apps
- Rutas para cada miniapp
- Health check endpoint

## üö´ Errores Comunes a Evitar

1. **No usar try-catch en funciones async** - Siempre incluir manejo de errores
2. **L√≥gica de negocio en m√≥dulos UI** - Separar responsabilidades
3. **Validaciones solo en el cliente** - Validar tambi√©n en el backend
4. **No manejar desconexiones WebSocket** - Implementar reconexi√≥n autom√°tica
5. **No limpiar callbacks** - Limpiar listeners al destruir componentes
6. **Hardcodear URLs** - Usar configuraci√≥n centralizada
7. **No manejar estados de carga** - Mostrar indicadores durante operaciones async
8. **Exponer tokens en logs** - No loggear informaci√≥n sensible
9. **No validar datos de Telegram** - Validar siempre datos de `window.Telegram`
10. **No manejar timeouts** - Implementar timeouts para operaciones async

## ‚úÖ Buenas Pr√°cticas

1. **Modularidad** - Un archivo por responsabilidad
2. **Callbacks configurables** - Permitir configurar callbacks desde fuera
3. **Manejo de errores consistente** - Usar try-catch y callbacks de error
4. **Logging descriptivo** - Logs claros con contexto
5. **Configuraci√≥n centralizada** - Todo en archivos config.js
6. **Validaci√≥n de entrada** - Validar datos antes de enviar
7. **Estados claros** - Definir y documentar todos los estados
8. **Reconexi√≥n autom√°tica** - WebSocket debe reconectar autom√°ticamente
9. **Recuperaci√≥n de estado** - Recuperar transacciones activas despu√©s de reconexi√≥n
10. **Documentaci√≥n JSDoc** - Comentar funciones complejas

## üì± Telegram Web App

### Integraci√≥n con Telegram

- Usar `window.Telegram.WebApp` para integraci√≥n
- Validar que Telegram est√© disponible antes de usar
- Expandir la app cuando est√© lista
- Obtener datos del usuario desde `initDataUnsafe`
- Manejar eventos de Telegram (back button, viewport, etc.)

### Patr√≥n de Telegram Auth

```javascript
class TelegramAuth {
  constructor() {
    this.userData = null;
    this.initData = null;
  }

  /**
   * Inicializar Telegram Web App
   */
  async init() {
    if (!window.Telegram || !window.Telegram.WebApp) {
      throw new Error(MESSAGES.ERROR.TELEGRAM_NOT_AVAILABLE);
    }

    const tg = window.Telegram.WebApp;
    
    // Expandir la app
    tg.expand();
    
    // Obtener datos de inicializaci√≥n
    this.initData = tg.initData;
    
    // Obtener datos del usuario
    const user = tg.initDataUnsafe?.user;
    if (!user) {
      throw new Error(MESSAGES.ERROR.USER_DATA_MISSING);
    }

    this.userData = user;
    
    // Validar con backend
    await this.validateWithBackend();
  }

  /**
   * Validar con backend
   */
  async validateWithBackend() {
    // Enviar initData al backend para validaci√≥n
    const response = await API.validateTelegramAuth(this.initData);
    if (!response.ok) {
      throw new Error("Error validando autenticaci√≥n de Telegram");
    }
  }
}

export const TelegramAuth = new TelegramAuth();
```

## üîî Notificaciones

### Sistema de Notificaciones

- Notificaciones toast para feedback inmediato
- Notificaciones persistentes para eventos importantes
- Notificaciones push del navegador (si est√° disponible)
- Service Worker para notificaciones en background

### Patr√≥n de Notificaciones

```javascript
// Notificaciones toast (temporales)
if (window.notificationManager) {
  window.notificationManager.success("T√≠tulo", "Mensaje");
  window.notificationManager.error("T√≠tulo", "Mensaje");
  window.notificationManager.info("T√≠tulo", "Mensaje");
  window.notificationManager.warning("T√≠tulo", "Mensaje");
}

// Notificaciones del navegador (persistentes)
if (window.browserNotifications) {
  await window.browserNotifications.showNotification("T√≠tulo", {
    body: "Mensaje",
    icon: "/icon.png",
  });
}
```

## üß™ Testing y Desarrollo

### Desarrollo Local

- Usar `npm run dev` para servidor local
- Conectar a backend en fly.io (no local)
- Probar en navegador normal (no Telegram)
- Usar herramientas de desarrollo del navegador

### Debugging

- Usar `console.log` con emojis para identificaci√≥n r√°pida
- Usar `window.visualLogger` si est√° disponible
- Inspeccionar WebSocket en DevTools
- Verificar peticiones HTTP en Network tab

## üìù Documentaci√≥n

### Comentarios JSDoc

- Comentar todas las clases y m√©todos p√∫blicos
- Documentar par√°metros y retornos
- Incluir ejemplos cuando sea √∫til
- Mantener comentarios actualizados

### README por Miniapp

- Cada miniapp debe tener su README.md
- Documentar prop√≥sito, estructura, y uso
- Incluir instrucciones de desarrollo
- Documentar variables de entorno necesarias
